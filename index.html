<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>WMS2PDF print demo</title>
</head>
<body>
<h3>Demo servei PrintMap Progess</h3>
Cal cridar el geoservei print/print2.php enviant el paràmetre 'printData' amb el següent JSON per POST (veure funció sendJson). La crida retorna un enllaç al document PDF (funció getPDFLink).<br>
Per veure impressió resultant a PDF prémer: <button type="button">Cridar servei</button><br/>
<textarea readonly id="seeJson" rows="34" cols="240">
</textarea>
<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
<script src="print/examples/progess.js"></script>
<script>

function getPDFLink(data) {
    if (data.error == 0) {
        //window.open(data.url,"_blank","menubar=no,toolbar=no,scrollbars=no,status=no,resizable=no");
        location.href= "print/print2.php?pdfUrl="+data.url;
    //window.location = this.printServerUrl+"?pdfUrl="+data.url;
    } else {
        alert("Error creating pdf: " + data.error);
    }

}

function sendJson() {
        $.ajax({
            type: "POST",
            url: "print/print2.php",
            data: { printData: JSON.stringify(json)},
            contentType: "application/x-www-form-urlencoded",
            dataType: "json",
            success: function(data){
                getPDFLink(data);
            },
            failure: function(errMsg) {
                alert(errMsg);
            }
        });
}

$( document ).ready(function() {
    var str = JSON.stringify(json, undefined, 2); // indentation level = 2
    $("#seeJson").html(str);
    $(":button").click(function() {
       sendJson(); 
    });
});

</script>
</body>
</html>